---
const { hasRightSidebar, backUrl } = Astro.props;
import LinkIcon from "./helpers/linkIcon.astro";
import ThemeToggle from "./ui/themeToggle.astro";

---
<nav
class="bg-white/90 backdrop-blur-md px-2 sm:px-4 py-1.5 dark:bg-gray-900 fixed w-full z-20 top-0 left-0 border-b border-gray-200 dark:border-gray-600"
>
<div class="container flex flex-wrap items-center justify-between mx-auto">
    {
      backUrl ? (
        <button
          id="back-button"
          type="button"
          class="inline-flex items-center md:hidden p-2 text-sm text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
        >
          <img src="/assets/img/icons/arrow-back.svg" class="h-7 w-7" />
        </button>
      ) : (
        <button
          data-drawer-target="drawer-navigation"
          data-drawer-show="drawer-navigation"
          data-drawer-placement="navigation"
          aria-controls="drawer-navigation"
          type="button"
          class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
        >
          <span class="sr-only">Open main menu</span>
          <img src="/assets/img/icons/menu1.svg" class="h-7 w-7" />
        </button>
      )
    }

    <a href="/" class="flex items-center">
      <!-- CuCoders logo svg -->
      <svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 687 207" width="687" height="207" class="h-8 mr-3 sm:h-9 w-fit dark:fill-gray-100">
        <title>logo_base</title>
        <path id="cu coders copy 4" class="s0" aria-label="cu coders"  d="m99.6 126.2q5.2 0 8.5-2.9 3.2-2.8 3.3-7.5h17.6q-0.1 7.1-3.9 13.1-3.8 5.9-10.5 9.2-6.6 3.2-14.6 3.2-15.1 0-23.7-9.5-8.7-9.6-8.7-26.5v-1.2q0-16.2 8.6-25.9 8.6-9.6 23.6-9.6 13.2 0 21.1 7.5 8 7.5 8.1 19.9h-17.6q-0.1-5.4-3.3-8.8-3.3-3.4-8.6-3.4-6.5 0-9.9 4.7-3.3 4.8-3.3 15.5v1.9q0 10.8 3.3 15.6 3.3 4.7 10 4.7zm82.6 13.8l-0.5-7.1q-7 8.4-19.2 8.4-11.3 0-17.2-6.5-5.9-6.5-6.1-19v-45.9h18.8v45.3q0 10.9 9.9 10.9 9.6 0 13.1-6.6v-49.6h18.8v70.1zm94-13.8q5.2 0 8.4-2.9 3.3-2.8 3.4-7.5h17.5q0 7.1-3.8 13.1-3.9 5.9-10.5 9.2-6.7 3.2-14.7 3.2-15 0-23.7-9.5-8.7-9.6-8.7-26.5v-1.2q0-16.2 8.6-25.9 8.6-9.6 23.7-9.6 13.1 0 21 7.5 8 7.5 8.1 19.9h-17.5q-0.1-5.4-3.4-8.8-3.2-3.4-8.5-3.4-6.6 0-10 4.7-3.3 4.8-3.3 15.5v1.9q0 10.8 3.3 15.6 3.3 4.7 10.1 4.7zm37.1-21.1v-0.8q0-10.4 4-18.6 4.1-8.2 11.6-12.6 7.6-4.5 17.5-4.5 14.2 0 23.2 8.7 9 8.7 10 23.6l0.1 4.8q0 16.1-9 25.9-9 9.7-24.1 9.7-15.2 0-24.3-9.7-9-9.7-9-26.5zm18.7 0.6q0 9.9 3.8 15.2 3.8 5.3 10.8 5.3 6.8 0 10.6-5.2 3.8-5.2 3.8-16.7 0-9.8-3.8-15.2-3.8-5.3-10.8-5.3-6.8 0-10.6 5.3-3.8 5.3-3.8 16.6zm56.4-1.3q0-16.4 7.3-26.1 7.4-9.7 20.1-9.7 10.3 0 16.9 7.6v-35.7h18.8v99.5h-16.9l-0.9-7.5q-7 8.8-18 8.8-12.4 0-19.9-9.7-7.4-9.8-7.4-27.2zm18.7 1.4q0 9.8 3.4 15.1 3.5 5.2 10 5.2 8.7 0 12.2-7.3v-27.7q-3.5-7.3-12.1-7.3-13.5 0-13.5 22zm91.2 35.5q-15.4 0-25.1-9.5-9.7-9.4-9.7-25.2v-1.8q0-10.5 4.1-18.8 4.1-8.4 11.5-12.9 7.6-4.5 17.1-4.5 14.4 0 22.7 9.1 8.3 9 8.3 25.7v7.6h-44.7q0.9 6.9 5.5 11.1 4.6 4.1 11.6 4.1 10.8 0 16.9-7.8l9.2 10.3q-4.2 5.9-11.4 9.3-7.2 3.3-16 3.3zm-2.1-57.5q-5.6 0-9.1 3.7-3.4 3.8-4.4 10.8h26.1v-1.5q-0.2-6.2-3.4-9.6-3.3-3.4-9.2-3.4zm81.2-14.4l-0.2 18q-3.8-0.5-6.8-0.5-10.6 0-13.9 7.2v45.9h-18.7v-70.1h17.7l0.5 8.3q5.6-9.6 15.6-9.6 3.1 0 5.8 0.8zm46.8 51.2q0-3.4-3.5-5.4-3.3-2-10.9-3.5-25-5.3-25-21.3 0-9.3 7.7-15.5 7.8-6.3 20.3-6.3 13.4 0 21.3 6.3 8.1 6.3 8.1 16.3h-18.7q0-4-2.6-6.6-2.6-2.7-8.1-2.7-4.8 0-7.4 2.2-2.6 2.1-2.6 5.4 0 3.1 3 5.1 2.9 1.9 9.9 3.3 7 1.3 11.8 3.1 14.9 5.4 14.9 18.8 0 9.6-8.3 15.6-8.2 5.9-21.2 5.9-8.8 0-15.7-3.1-6.8-3.2-10.7-8.6-3.9-5.5-3.9-11.9h17.8q0.2 5 3.7 7.7 3.4 2.6 9.2 2.6 5.4 0 8.1-2 2.8-2.1 2.8-5.4z"/>
        <path id="Path 0" fill-rule="evenodd" class="s0" d="m42 34h191v138h-191zm20 123h151v-109h-151z"/>
        <path id="Path 1" class="s0" d="m249 157h57v15h-57v-7.5z"/>
      </svg>
    </a>

    <div class="md:hidden w-11 h-11">
      {
        hasRightSidebar && (
          <button
            data-drawer-target="drawer-right"
            data-drawer-show="drawer-right"
            data-drawer-placement="right"
            aria-controls="drawer-right"
            type="button"
            class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
            aria-controls="navbar-sticky"
            aria-expanded="false"
          >
            <span class="sr-only">Open right menu</span>
            <img src="/assets/img/icons/filter-list.svg" class="h-7 w-7" />
          </button>
        )
      }
    </div>
    <div class="md:order-2 hidden md:flex">
      <div class="mr-0">
        <LinkIcon
          url="https://t.me/CuCodersComunidad"
          text="Comunidad en Telegram"
          id="nav-community-icon"
          target="_blank"
          img="/assets/img/icons/people2.svg"
        >
          <!-- 
            esta línea declara que el texto "Comunidad" tiene color oscuro en el modo oscuro.
            no es un error. Al generarse el componente LinkIcon en la página, se le aplica un estilo 'dark:invert'.
            Eso provoca que el color de este texto sea invertido y aparezca claro al renderizarse.S
          -->
          <span class="mr-2 font-medium md:hidden lg:inline dark:text-gray-900 "> Comunidad</span>
        </LinkIcon>
      </div>

      <button
        id="maninMenuDropdown"
        data-dropdown-toggle="dropdownMainMenu"
        class="inline-flex items-center p-2 text-sm font-medium text-center text-gray-900 bg-white rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none dark:text-white focus:ring-gray-50 dark:bg-gray-900 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
        type="button"
        aria-label="Open main menu"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 48 48" class="w-6 h-6 fill-gray-700 dark:fill-gray-400">
          <path d="M6 8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8Zm0 13a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-6Zm0 13a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-6ZM19 8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2V8Zm0 13a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-6Zm0 13a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-6ZM32 8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2V8Zm0 13a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-6Zm0 13a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-6Z"/>
        </svg>
      </button>
      <ThemeToggle id="navBarToggle" layout="non-mobile" />
    </div>
    <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
      <ul
        class="flex flex-col p-4 mt-4 rounded-lg md:flex-row lg:space-x-8 md:space-x-4 md:mt-0 md:text-sm md:font-medium dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700"
      >
        <li>
          <a
            href="/"
            class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-gray-800 md:p-0 md:dark:hover:text-white dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
            >Inicio</a
          >
        </li>
        <li>
          <a
            href="/directorio"
            class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-gray-800 md:p-0 md:dark:hover:text-white dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
            >Coders</a
          >
        </li>
        <li>
          <a
            href="/empleos"
            class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-gray-800 md:p-0 md:dark:hover:text-white dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
            >Empleos</a
          >
        </li>
        <li>
          <a
            href="/apps"
            class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-gray-800 md:p-0 md:dark:hover:text-white dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
            >Apps</a
          >
        </li>
        <li>
          <a
            href="/eventos"
            class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-gray-800 md:p-0 md:dark:hover:text-white dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
            >Eventos</a
          >
        </li>
        <li>
          <button
            id="dropdownNavbarLink"
            data-dropdown-toggle="dropdownNavbar"
            class="flex items-center justify-between w-full py-2 pl-3 pr-4 font-medium text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-gray-700 md:p-0 md:w-auto dark:text-gray-400 dark:hover:text-white dark:focus:text-white dark:border-gray-700 dark:hover:bg-gray-700 md:dark:hover:bg-transparent"
            >Formación <svg
              class="w-5 h-5 ml-1"
              aria-hidden="true"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
              ><path
                fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd"></path></svg
            ></button
          >
          <div
            id="dropdownNavbar"
            class="z-10 hidden font-normal bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dark:divide-gray-600"
          >
            <ul class="py-2 text-sm text-gray-700 dark:text-gray-400" aria-labelledby="dropdownLargeButton">
              <li>
                <a
                  href="/formacion/rutas"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Rutas</a
                >
              </li>
              <li>
                <a
                  href="/recursos/formacion-integral"
                  class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Recursos</a
                >
              </li>
            </ul>
          </div>
        </li>
        <li>
          <a
            href="/recursos"
            class="block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-gray-800 md:p-0 md:dark:hover:text-white dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
            >Recursos</a
          >
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main menu dropdown -->
<div
  id="dropdownMainMenu"
  class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dark:divide-gray-600"
>
  <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownMenuIconButton">
    <li>
      <a
        href="/perfil"
        class="inline-flex w-full items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
      >
        <img src="/assets/img/icons/profile.svg" class="w-5 h-5 mr-2" />
        Perfil
      </a>
    </li>
    <li>
      <a
        href="/registro"
        class="inline-flex w-full items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
      >
        <img src="/assets/img/icons/login.svg" class="w-5 h-5 mr-2" />
        Regístrate
      </a>
    </li>
  </ul>
  <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownMenuIconButton">
    <li>
      <a href="/nueva-publicacion" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
        >Crear Publicación</a
      >
    </li>
    <li>
      <a href="/nueva-app" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
        >Publicar Aplicación</a
      >
    </li>
    <li>
      <a href="/nuevo-empleo" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
        >Publicar Empleo</a
      >
    </li>
    <li>
      <a href="/nuevo-evento" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
        >Publicar Evento</a
      >
    </li>
    <li>
      <a href="/nuevo-recurso" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
        >Adicionar Recurso</a
      >
    </li>
  </ul>

  <div class="py-2">
    <a
      href="/acerca-de"
      class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white"
      >Acerca de CuCoders
    </a>
  </div>
</div>

<script define:vars={{ backUrl }}>
  const backBtn = document.querySelector("#back-button");

  backBtn &&
    backBtn.addEventListener("click", function () {
      if (history.length != 0 && document.referrer.includes("cucoders.dev")) {
        history.back();
      } else {
        window.location.href = backUrl;
      }
    });


    // theme toggle script
    let themeToggleBtn = document.getElementById('navBarToggle');
    
    themeToggleBtn.addEventListener('click', function() {

    // if set via local storage previously
    if (localStorage.getItem('color-theme')) {
        if (localStorage.getItem('color-theme') === 'light') {
            document.documentElement.classList.add('dark');
            localStorage.setItem('color-theme', 'dark');
        } else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('color-theme', 'light');
        }
        
        // if NOT set via local storage previously
    } else {
        if (document.documentElement.classList.contains('dark')) {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('color-theme', 'light');
        } else {
            document.documentElement.classList.add('dark');
            localStorage.setItem('color-theme', 'dark');
        }
    }
        
    });
</script>
